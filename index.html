<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>إشعارك — النظام التجريبي</title>
<style>
  :root{
    --green:#0f6848;
    --muted:#f2f2f2;
    --card:#fff;
    --accent:#0f6848;
  }
  body{margin:0;font-family:Tahoma, Arial, sans-serif;background:var(--muted);color:#111}
  header{background:var(--green);color:#fff;padding:14px 18px;text-align:center;font-size:20px;font-weight:700}
  .nav{display:flex;gap:10px;justify-content:center;padding:12px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  .nav button{background:none;border:1px solid transparent;padding:8px 12px;border-radius:8px;cursor:pointer}
  .nav button.active{border-color:var(--green);color:var(--green);font-weight:600}
  .container{max-width:980px;margin:18px auto;padding:10px}
  /* grid services */
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.06);text-align:center}
  .card .label{margin-top:10px;font-weight:600}
  /* icons */
  .shield{width:72px;height:82px;margin:0 auto;background:var(--green);clip-path:polygon(50% 0,90% 22%,90% 65%,50% 100%,10% 65%,10% 22%);display:flex;align-items:center;justify-content:center;color:#fff;font-size:32px;font-weight:700}
  .wheel,.passport,.searchIcon,.calendar,.usericon{margin:0 auto}
  .wheel{width:64px;height:64px;border:6px solid var(--green);border-radius:50%;position:relative}
  .wheel::before{content:"";width:36px;height:36px;border:4px solid var(--green);border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
  .wheel::after{content:"";width:8px;height:42px;background:var(--green);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
  .passport{width:68px;height:86px;background:var(--green);border-radius:6px;position:relative}
  .passport::before{content:"";width:40px;height:40px;border:3px solid #fff;border-radius:50%;position:absolute;top:24px;left:50%;transform:translateX(-50%)}
  .searchIcon{width:48px;height:48px;border:6px solid var(--green);border-radius:50%;position:relative}
  .searchIcon::after{content:"";width:10px;height:28px;background:var(--green);position:absolute;bottom:-20px;left:50%;transform:translateX(-50%) rotate(35deg);border-radius:4px}
  .calendar{width:72px;height:56px;border-radius:8px;border:4px solid var(--green);position:relative}
  .calendar::before{content:"";width:100%;height:18px;background:var(--green);position:absolute;top:0;left:0;border-radius:6px 6px 0 0}
  .usericon{width:72px;height:82px;position:relative}
  .usericon::before{content:"";width:32px;height:32px;background:var(--green);border-radius:50%;position:absolute;top:6px;left:50%;transform:translateX(-50%)}
  .usericon::after{content:"";width:56px;height:34px;background:var(--green);position:absolute;bottom:6px;left:50%;transform:translateX(-50%);border-radius:18px 18px 8px 8px}
  footer{padding:12px;background:var(--green);color:#fff;text-align:center;margin-top:20px}
  /* pages */
  .page{display:none}
  .page.active{display:block}
  /* check form */
  .form-row{display:flex;gap:10px;margin:12px 0;flex-wrap:wrap}
  input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd}
  .btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
  .resultBox{margin-top:14px;padding:14px;border-radius:10px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.04)}
  .risk-high{color:#b71c1c;font-weight:700}
  .risk-medium{color:#f57f17;font-weight:700}
  .risk-safe{color:#0f6848;font-weight:700}
  /* reports list */
  .report-item{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px;border-left:6px solid var(--accent)}
  .small{font-size:13px;color:#666}
  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);z-index:50}
  .modal.show{display:flex}
  .modal .card{max-width:900px;width:96%}
  .hint{font-size:13px;color:#555;margin-top:8px}
  .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
  @media(max-width:720px){.grid{grid-template-columns:repeat(1,1fr)}}
</style>
</head>
<body>
<header>منصة أبشر — خدمة إشعارك (النسخة التجريبية)</header>

<div class="nav">
  <button class="navBtn active" data-page="home">الرئيسية</button>
  <button class="navBtn" data-page="check">فحص رابط</button>
  <button class="navBtn" data-page="report">رفع بلاغ</button>
  <button class="navBtn" data-page="reportsList">قائمة البلاغات</button>
  <button class="navBtn" data-page="arch">معمارية النظام</button>
</div>

<div class="container">

  <!-- HOME -->
  <div id="home" class="page active">
    <div class="grid">
      <div class="card">
        <div class="shield">!</div>
        <div class="label">إشعارك — تنبيهات البطاقة</div>
        <div class="hint">خدمة تحمي من الروابط الاحتيالية وسرقة الحسابات</div>
      </div>
      <div class="card">
        <div class="wheel"></div>
        <div class="label">خدمات المرور</div>
      </div>
      <div class="card">
        <div class="passport"></div>
        <div class="label">الجوازات</div>
      </div>
      <div class="card">
        <div class="searchIcon"></div>
        <div class="label">الاستعلامات</div>
      </div>
      <div class="card">
        <div class="calendar"></div>
        <div class="label">المواعيد</div>
      </div>
      <div class="card">
        <div class="usericon"></div>
        <div class="label">خدماتي</div>
      </div>
    </div>

    <div style="margin-top:18px" class="card">
      <h3>عن النموذج</h3>
      <p class="small">هذا النموذج تفاعلي ويُظهر كيف يمكن لفحص رابط ورفع بلاغ أن يعملان داخل أبشر. التحليل الحالي محاكاة (heuristic + قواعد كلمات مفتاحية). تم تجهيز نقاط دمج جاهزة لربطها لاحقاً بـ Allam/Triton/Milvus.</p>
      <div class="actions">
        <button class="btn" id="open-arch">عرض مخطط المعمارية</button>
      </div>
    </div>
  </div>

  <!-- CHECK URL -->
  <div id="check" class="page">
    <div class="card">
      <h3>فحص رابط مشبوه</h3>
      <div class="form-row">
        <input id="urlInput" type="text" placeholder="ألصق الرابط هنا (مثال: http://example.com/..)" />
        <button class="btn" id="analyzeBtn">فحص</button>
      </div>
      <div id="analysisResult" class="resultBox" style="display:none"></div>

      <div style="margin-top:12px" class="hint">
        <strong>ملاحظة:</strong> الفحص الحالي محاكة تعليمية. لاستبدالها بنظام حقيقي — استبدلي دالة <code>callModelAPI()</code> بعنوان سيرفرك (Triton / Allam) ثم قمّي بنشر النموذج على NVIDIA GPU.
      </div>
    </div>
  </div>

  <!-- REPORT FORM -->
  <div id="report" class="page">
    <div class="card">
      <h3>رفع بلاغ احتيال</h3>
      <label>نوع الاحتيال</label>
      <select id="reportType">
        <option value="link">رابط مزيف</option>
        <option value="sms">رسالة نصية</option>
        <option value="call">مكالمة تهديد</option>
        <option value="account">محاولة سرقة حساب</option>
      </select>

      <div style="margin-top:10px">
        <label>تفاصيل (مستلم/النص/الوقت)</label>
        <textarea id="reportDetails" rows="4" placeholder="أدخل تفاصيل البلاغ هنا"></textarea>
      </div>

      <div style="margin-top:10px" class="form-row">
        <input id="reportPhone" type="text" placeholder="رقم الهاتف أو الرابط (اختياري)" />
        <button class="btn" id="submitReport">إرسال البلاغ</button>
      </div>

      <div id="submitMsg" class="hint" style="display:none"></div>

      <div style="margin-top:12px" class="hint">
        البلاغات تحفظ محلياً (localStorage). لتحويلها لقاعدة بيانات حقيقية — استبدلي دالة <code>saveReportToServer()</code> بنقطة نهاية حقيقية (API) أو وظيفة GitHub Actions ترفع الملف إلى السجل المركزي أو Milvus.
      </div>
    </div>
  </div>

  <!-- REPORTS LIST -->
  <div id="reportsList" class="page">
    <div class="card">
      <h3>قائمة البلاغات (محلياً)</h3>
      <div id="reportsContainer"></div>
      <div style="margin-top:12px" class="actions">
        <button class="btn" id="exportReports">تحميل JSON</button>
        <button class="btn" id="clearReports" style="background:#b71c1c">مسح الكل</button>
      </div>
    </div>
  </div>

  <!-- ARCHITECTURE -->
  <div id="arch" class="page">
    <div class="card">
      <h3>مخطط المعمارية والربط مع الأنظمة المطلوبة</h3>
      <p class="small">في العرض تشرحين أن النموذج يعمل كالتالي (بحث سريع لتقديم الشرح):</p>
      <ul class="small">
        <li><strong>الواجهة (Frontend)</strong> — index.html تعرض الفحص ورفع البلاغات.</li>
        <li><strong>نقطة النموذج (Model Serving)</strong> — Triton Server يستضيف نموذج Allam (عربي) المسرّع بواسطة TensorRT-LLM على NVIDIA GPU Server.</li>
        <li><strong>Guardrails</strong> — طبقة تحكم قبل عرض النتائج للمستخدم لضمان عدم خروج الردود عن النص.</li>
        <li><strong>Milvus / Qdrant</strong> — قاعدة متجهات لحفظ الأمثلة والبلاغات لاكتشاف الأنماط الشاذة وربطها لاحقاً.</li>
        <li><strong>Notifications</strong> — إشعارات Push / SMS عبر موفري الإشعارات بعد تحقق أمني.</li>
      </ul>

      <div style="margin-top:10px" class="hint">
        أسطر مهمة: عند الانتقال لإنتاج حقيقي — استخدمي HTTPS endpoints، تحقق مُحكم، وسجلات وتشفير (PKI).
      </div>
    </div>
  </div>

</div>

<footer>© 2025 إشعارك — نموذج تجريبي قابل للترقية إلى Allam / Triton / Milvus</footer>

<!-- Modal for architecture details -->
<div id="modal" class="modal">
  <div class="card" style="padding:18px">
    <h3>مخطط الربط (تفصيلي)</h3>
    <p class="small">
      <strong>مقترح ربط تقني سريع:</strong><br>
      1) Frontend (هذا المشروع) يُرسل الرابط للنموذج عبر HTTPS إلى Triton (model-server).<br>
      2) Triton يحمّل نموذج Allam/TensorRT-LLM ويعيد نتيجة مصنفة (score + explanation).<br>
      3) Guardrails يقوم بتصفية الرد وضمان عدم تسريب معلومات. ثم تُخزن نتائج البلاغات في Milvus (Vector DB).<br>
      4) نظام الإشعارات يوزّع التنبيهات عبر push/SMS/إشعارات أبشر عبر API موثوق.
    </p>
    <div class="actions">
      <button class="btn" id="closeModal">إغلاق</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
  Frontend logic (single file)
   - تحليل رابط (محاكاة heuristic + keywords)
   - رفع بلاغ وحفظ محلي (localStorage)
   - export JSON
   - hooks لموضوع الربط بـ Allam / Triton (تعليمات)
---------------------------*/

document.querySelectorAll('.navBtn').forEach(btn=>{
  btn.addEventListener('click',()=> {
    document.querySelectorAll('.navBtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const page = btn.dataset.page;
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(page).classList.add('active');
  });
});

// Modal
document.getElementById('open-arch').onclick = ()=> document.getElementById('modal').classList.add('show');
document.getElementById('closeModal').onclick = ()=> document.getElementById('modal').classList.remove('show');

/* ---------- Simulated Analyzer ---------- */

/**
 * analyzeLink(url) -> returns {risk:'safe'|'medium'|'high',score:0..100,explanation:string}
 * This is a heuristic + keyword-based simulation. Replace callModelAPI() with a real model endpoint for production.
 */
function analyzeLink(url){
  url = (url||'').trim();
  if(!url) return {risk:'medium',score:40,explanation:'لم يتم إدخال رابط'};
  const lower = url.toLowerCase();

  // quick heuristics:
  let score = 10;
  const blacklisted = ['.zip','.exe','.scr','.php?download','/login','/signin','/verify','/confirm'];
  const suspiciousWords = ['free','prize','urgent','verify','confirm','login','update','account','ssn','bank','transfer'];
  const shorteners = ['bit.ly','tinyurl.com','t.co','goo.gl','ow.ly','rb.gy'];

  // ip-address instead of domain
  if(/\b\d{1,3}(\.\d{1,3}){3}\b/.test(url)) score += 30;
  // shorteners
  if(shorteners.some(s=>lower.includes(s))) score += 25;
  // suspicious extensions
  if(blacklisted.some(b=>lower.includes(b))) score += 40;
  // presence of at symbol or excessive query params
  if(lower.includes('@') || (lower.split('?').length>1 && lower.split('&')
   length>3)) score += 18;
  // long weird paths
  if(lower.length>80) score += 12;
  // suspicious keywords
  suspiciousWords.forEach(w=>{ if(lower.includes(w)) score += 12 });

  // domain lookalike (ex: go0ogle.com)
  const domainMatch = lower.match(/\/\/([^\/]+)/);
  if(domainMatch){
    const domain = domainMatch[1];
    // simple homoglyph check: numbers inside like '0' for 'o'
    if(/[0-9]/.test(domain) && domain.length>6) score += 10;
  }

  // capped score
  if(score>95) score=95;

  // final mapping
  let risk = 'safe';
  if(score>=60) risk='high';
  else if(score>=30) risk='medium';
  else risk='safe';

  // explanation
  let explanation = 'تحليل مبدئي: ';
  if(risk==='high') explanation += 'يبدو أن الرابط يحتوي عناصر خطرة (امتداد/اختصار/نمط مشبوه). يستحسن عدم فتحه وإبلاغ الجهات.';
  else if(risk==='medium') explanation += 'الرابط يحتمل أن يكون مريباً — تأكد من المرسل والمجال قبل التفاعل.';
  else explanation += 'الرابط يبدو آمناً وفق القواعد الأولية.';

  return {risk,score,explanation};
}

/* ---------- UI for Analysis ---------- */
const analyzeBtn = document.getElementById('analyzeBtn');
const urlInput = document.getElementById('urlInput');
const resultBox = document.getElementById('analysisResult');

analyzeBtn.addEventListener('click', async ()=>{
  const url = urlInput.value.trim();
  resultBox.style.display='block';
  resultBox.innerHTML = '<em>جارِ الفحص...</em>';
  // simulate latency
  await new Promise(r=>setTimeout(r,600));

  // (1) call local heuristic
  const r = analyzeLink(url);

  // (2) placeholder to call real model (Allam/Triton) - see callModelAPI()
  // const modelResp = await callModelAPI(url); // uncomment if real API exists

  // Merge (for now just show simulated)
  let html = <div><strong>النتيجة:</strong> ;
  if(r.risk==='high') html += <span class="risk-high">خطر عالي</span>;
  else if(r.risk==='medium') html += <span class="risk-medium">مشكوك</span>;
  else html += <span class="risk-safe">آمن</span>;
  html += </div>;
  html += <div class="small" style="margin-top:8px">Score: ${r.score}%</div>;
  html += <p style="margin-top:10px">${r.explanation}</p>;

  // action suggestions
  html += <div class="small"><strong>نصائح:</strong><ul><li>لا تدخل بياناتك.</li><li>لا تفتح روابط لم تُتوقعها.</li><li>بلّغ عن الرابط إن شككت.</li></ul></div>;

  // quick action buttons
  html += `<div style="margin-top:10px" class="actions">
    <button class="btn" onclick="saveAsReport('link','${escapeHtml(url)}','تم الفحص: ${r.risk}')">رفع بلاغ عن هذا الرابط</button>
    <button class="btn" onclick="copyToClipboard('${escapeHtml(url)}')">نسخ الرابط</button>
  </div>`;

  resultBox.innerHTML = html;
});

// helper
function copyToClipboard(text){
  navigator.clipboard?.writeText(text).then(()=>alert('نُسخ للوحه الحافظة'));
}

function escapeHtml(s){ return (s||'').replace(/'/g,"&#39;").replace(/"/g,'&quot;').replace(/</g,'&lt;') }

/* ---------- Report saving (localStorage) ---------- */
const REPORTS_KEY = 'ishaarek_reports_v1';
function loadReports(){ try{ return JSON.parse(localStorage.getItem(REPORTS_KEY) || '[]') }catch(e){return []} }
function saveReports(arr){ localStorage.setItem(REPORTS_KEY, JSON.stringify(arr, null, 2)) }

function saveAsReport(type, reference, details){
  const reports = loadReports();
  const id = 'R-'+Date.now();
  const item = {
    id, type, reference, details,
    createdAt: new Date().toISOString(),
    status: 'new'
  };
  reports.unshift(item);
  saveReports(reports);
  refreshReportsUI();
  alert('تم حفظ البلاغ محلياً');
}

// submit form
document.getElementById('submitReport').addEventListener('click', async ()=>{
  const type = document.getElementById('reportType').value;
  const details = document.getElementById('reportDetails').value.trim();
  const ref = document.getElementById('reportPhone').value.trim();
  if(!details && !ref){ alert('أدخل تفاصيل أو رابط أو رقم'); return; }
  saveAsReport(type, ref, details || 'لا تفاصيل إضافية');
  document.getElementById('submitMsg').style.display='block';
  document.getElementById('submitMsg')
  textContent = 'تم حفظ البلاغ محلياً. يمكنك تصدير البلاغات أو إرسالها لاحقاً إلى الخادم.';
  // Optional: try to send to server if endpoint provided
  // await saveReportToServer({type,reference:ref,details});
});

// export & UI
document.getElementById('exportReports').addEventListener('click', ()=>{
  const reports = loadReports();
  const blob = new Blob([JSON.stringify(reports, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'ishaarek_reports.json'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('clearReports').addEventListener('click', ()=>{
  if(confirm('مسح كل البلاغات من التخزين المحلي؟')){ localStorage.removeItem(REPORTS_KEY); refreshReportsUI(); }
});

function refreshReportsUI(){
  const container = document.getElementById('reportsContainer');
  const reports = loadReports();
  if(reports.length===0){ container.innerHTML = '<p class="small">لا توجد بلاغات محفوظة محلياً.</p>'; return; }
  container.innerHTML = reports.map(r=>{
    return `<div class="report-item">
      <div><strong>${r.type} — ${r.id}</strong> <span class="small">(${new Date(r.createdAt).toLocaleString()})</span></div>
      <div class="small">المرجع: ${r.reference || '-'}</div>
      <div style="margin-top:6px">${escapeHtml(r.details)}</div>
      <div style="margin-top:8px" class="actions">
        <button class="btn" onclick="downloadSingle('${r.id}')">تحميل</button>
        <button class="btn" style="background:#b71c1c" onclick="deleteReport('${r.id}')">حذف</button>
      </div>
    </div>`;
  }).join('');
}

function downloadSingle(id){
  const reports = loadReports();
  const item = reports.find(r=>r.id===id);
  if(!item) return alert('غير موجود');
  const blob = new Blob([JSON.stringify(item,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download = ${id}.json; a.click();
  URL.revokeObjectURL(url);
}
function deleteReport(id){
  if(!confirm('حذف البلاغ؟')) return;
  let reports = loadReports();
  reports = reports.filter(r=>r.id!==id);
  saveReports(reports); refreshReportsUI();
}

/* --------- placeholders for real API integration --------- */

/**
 * Example: callModelAPI(url)
 * Replace API_URL with your Triton/Allam server endpoint. Expect JSON {risk,score,explanation}
 *
 * e.g.
 * const API_URL = 'https://your-triton.example.com/analyze';
 * return fetch(API_URL, {method:'POST', body:JSON.stringify({url}) ...})
 *
 * For production:
 * - Use HTTPS
 * - Add API Key / Auth
 * - Validate and sanitize inputs
 */
async function callModelAPI(url){
  // Demo: simulate remote call with additional "AI comment"
  await new Promise(r=>setTimeout(r,600));
  const base = analyzeLink(url);
  base.explanation += ' (مُحسّن بواسطة نموذج Allam التجريبي)';
  return base;
}

/**
 * Example to save report to server:
 * Replace SERVER_API with your backend that writes to Milvus/DB.
 * async function saveReportToServer(report){ return fetch(SERVER_API+'/reports',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(report) }) }
 */
async function saveReportToServer(report){
  console.warn('saveReportToServer: يجب استبدال هذه الدالة بنقطة نهاية حقيقية');
  // simulate latency
  await new Promise(r=>setTimeout(r,400));
  return {ok:true};
}

/* ---------- init ---------- */
refreshReportsUI();

/* optional: show page from hash */
(function(){
  const hash = location.hash.replace('#','');
  if(hash){
    const btn = document.querySelector(`.navBtn[data-page="${hash}"]`);
    if(btn) btn.click();
  }
})();
</script>
</body>
</html>
